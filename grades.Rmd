---
title: "Impact of COVID-19 Related Transition to Online Instruction on Student Achievement"
author: "Jason Holderieath"
date: "8/8/2020"
output:
  pdf_document: default
  html_document: default
  word_document: default
header-includes: \usepackage{dcolumn}
bibliography: sources.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tinytex.verbose = TRUE)
library(readxl)
library("scales")
library("stringr")
library("ggthemes") 
library(cowplot)
library(knitr)
library(kableExtra)
require(nnet)
library(stargazer)
library(lmtest)
library(sandwich)
library(tidyverse)
library(ggeffects)

set.seed(4798)
dat <- read_excel("Agriculture and Forestry Grades by Instructor and Course - Summer 2017 thru Spring 2020.xls") %>%
    rename(grade = `Grade Awarded`) %>%
    filter(grade != 'AU') %>%
    mutate(termC = as.character(Term)) %>%
    filter(str_detect(termC, "3$")) %>%
    mutate(Instructor = forcats::as_factor(Instructor), 
           Course = forcats::as_factor(Course),
           Term = forcats::as_factor(termC),
           Grade = factor(grade, levels = c("A", "B", "C", "D", "F", "W", "S", "IC"))) %>%
    mutate(Dept = forcats::as_factor(str_extract(Course, '[:alpha:]{3,4}')),
           Course_Number = forcats::as_factor(str_extract(Course, '[:digit:]{3}'))) %>%
    mutate(Upper = forcats::as_factor(ifelse(as.numeric(as.character(Course_Number)) >= 300,1,0))) %>%
    unite("ID", Dept:Course_Number, sep = "", remove = TRUE) %>%
    mutate(ID = forcats::as_factor(ID)) %>%
    dplyr::select(-c(termC,grade,Course))

dat$Instructor <- dat$Instructor %>% fct_anon()

dat$pfw <- fct_recode(dat$Grade, "PASS" = "A", "PASS" = "B", "PASS" = "C", "PASS" = "S", "FAIL" = "D", "FAIL" = "F")

dat <- dat %>%
  filter(ID != "FOR480")
```

Like many universities around the US, on Monday March 16, 2020 Louisiana Tech University (LaTech) transitioned to exclusively online instruction due to the COVID-19 pandemic [@laTechOnline]. LaTech is unique in that this nearly perfectly corresponded to the beginning of an academic term. LaTech is a quarter schedule, semester hour, school and in 2020 the spring quarter classes started on Wednesday March 10 with great uncertainty about the term [@UniversityRegistrar2020]. So much uncertainty surrounded the quarter that a syllabus statement cautioning that the quarter could be very different due to COVID-19 was required by the dean's office. 

For research purposes, this situation provides a natural experiment. Most courses of instruction were interrupted mid-term. LaTech transitioned online over a weekend that followed "syllabus day." This provides an opportunity to examine the impacts of a sudden shift in the mode of instruction, without the weight of weeks of traditional course delivery. 

Instructors expected that the grade distribution would be increasingly bi-modal with students either excelling or failing under the circumstances. We found...

# Methods

The authors requested grade information from the Registrar's office. We were unable to acquire any demographic data to accompany the grades,  nor were we successful in gaining permission to use our own records from the Human Use Committee. This is a severely incomplete picture of the determinants of grade; however, it is all we have.

The Registrar's office grade report contains information on instructor, course, term, and grade awarded for three spring terms (2018, 2019, and 2020) of courses offered through the School of Agricultural Sciences and Forestry (SASF). Instructor data was obfuscated by randomly generating a number to replace each instructor's name. Most spring quarter courses are typically taught by the same individual instructors. GISC-250   This results in a dataset with 2205 observations. Grades are the traditional "A-F" sequence with "W" for withdrawal. The University extended the “W” (Withdrawal) deadline for Spring 2020  from May 1, 2020, to May 15, 2020 and also provided an opportunity for students to choose "PASS/FAIL" grading not previously available at LaTech (a single "S" for "PASS" was present in the data for an internship in 2018, but this is extremely atypical). Students were able to elect "PASS/FAIL" _after_ the term was complete [@extendedWithdraw]."IC" is notation for "Incomplete," indicating that students have until a date in the fall to complete the course. As expected, "IC" grades are only present in the Spring 2020 term. 

```{r descriptive, echo=FALSE}

percent_grade <- dat %>%
    count(Term, Grade) %>%
    group_by(Term) %>%
    mutate(Percent = n / sum(n) * 100) %>%
    ungroup()

percent_pfw <- dat %>%
    count(Term, pfw) %>%
    group_by(Term) %>%
    mutate(Percent = n / sum(n) * 100) %>%
    ungroup() %>%
    filter(pfw == "PASS" | pfw == "FAIL" | pfw == "W") 

p <- percent_grade %>%
    ggplot(aes(x = Grade, y = Percent, fill = Term)) +
    geom_bar(stat = "identity", position = "dodge")+
    theme(legend.position="top")  

#  cowplot::theme_cowplot(font_size = 12) + 


inset <- ggplot(percent_pfw, aes(x = pfw, y= Percent, fill = Term)) + 
  geom_bar(stat = "identity", position = "dodge") + 
    cowplot::theme_cowplot(font_size = 12) +
    theme(legend.position = "none") + 
    xlab('') +
    ylab('') 
     

ggdraw(p +  theme_half_open(12)) +
  draw_plot(inset, .35, .45, .5, .5) +
  draw_plot_label(
    c("A", "B"),
    c(0, 0.35),
    c(1, 0.95),
    size = 12
  ) 
# +
```

Finishing a course is considered earning any grade other than "W" or "IC." Passing a class is counted as earning an "A", "B", "C", or "S." Some curriculum in the school allow "D" grades to be counted toward graduation; however, this is not the case for all of the degree programs. Therefore, grades of "D" and "F" are regarded as failing. The percent that passed a course and the percent that completed a course were both calculated. 

```{r tabsum, echo=FALSE}
options(knitr.kable.NA = '')
summary(dat) %>%
  kable(caption = "Counts of Variable Observations", 
        out = 'summary.html',
  col.names = linebreak(c("Instructor",
                          "Term",
                          "Grade (A-F,S,W)",
                          "Course",
                          "Upper-Level Course",
                          "Grade (PASS/FAIL/W)"
                          ), align = "c")
  )

```

Percent completing, percent passing, and percent earning an A in the course were modeled as a function of course and term. Courses are identified as a series of dummy variables and the 2020 term is identified as a dummy variable. Courses are further identified as upper level by a binary variable.

$$
Grade (Complete \ or \ Pass \ or \ A) = f(Course, \ Term)
$$
These two models are modeled as a Poisson process. A Poisson model is used to model count and rate data. Percent, rounded to the whole number, is appropriately modeled as a Poisson model.  @Guangyong maintained that a robust standard estimation procedure was needed when all independent variables are binary, so a sandwich estimator was employed.

```{r poissonmodel, include=FALSE}
d2 <- dat %>%
    fastDummies::dummy_cols() %>%
    group_by(Instructor,Term,ID,Upper)%>%
    summarise(PASSING = sum(Grade_A,Grade_B,Grade_C,Grade_S),
              FAILING = sum(Grade_D,Grade_F),
              FINISHING = sum(pfw_PASS,pfw_FAIL),
              NOTFINISHING = sum(pfw_W,pfw_IC),
              PCT_PASS = round(PASSING/(PASSING+FAILING)*100),
              PCT_FINISH = round(FINISHING/(FINISHING+NOTFINISHING)*100),
              PCT_A = round(Grade_A/(PASSING+FAILING)*100)
              )


d2_dum <- d2 %>%
    fastDummies::dummy_cols() %>%
    mutate(
Instructor_01  = forcats::as_factor(Instructor_01),
Instructor_02  = forcats::as_factor(Instructor_02),
Instructor_03  = forcats::as_factor(Instructor_03),
Instructor_04  = forcats::as_factor(Instructor_04),
Instructor_05  = forcats::as_factor(Instructor_05),
Instructor_06 =  forcats::as_factor(Instructor_06),
Instructor_07  = forcats::as_factor(Instructor_07),
Instructor_08  = forcats::as_factor(Instructor_08),
Instructor_09  = forcats::as_factor(Instructor_09),
Instructor_10  = forcats::as_factor(Instructor_10),
Instructor_11 =  forcats::as_factor(Instructor_11),
Instructor_12  = forcats::as_factor(Instructor_12),
Instructor_13  = forcats::as_factor(Instructor_13),
Instructor_14  = forcats::as_factor(Instructor_14),
Instructor_15  = forcats::as_factor(Instructor_15),
Instructor_16 =  forcats::as_factor(Instructor_16),
Instructor_17  = forcats::as_factor(Instructor_17),
Instructor_18  = forcats::as_factor(Instructor_18),
Term_20183     = forcats::as_factor(Term_20183),
Term_20193     = forcats::as_factor(Term_20193),
Term_20203     = forcats::as_factor(Term_20203),
ID_AGBU310  = forcats::as_factor(ID_AGBU310),  
ID_AGBU402  = forcats::as_factor(ID_AGBU402),  
ID_AGBU425  = forcats::as_factor(ID_AGBU425),  
ID_AGSC211  = forcats::as_factor(ID_AGSC211),   
ID_AGSC320  = forcats::as_factor(ID_AGSC320), 
ID_AGSC411  = forcats::as_factor(ID_AGSC411),  
ID_AGSC478  = forcats::as_factor(ID_AGSC478),  
ID_AGSC516  = forcats::as_factor(ID_AGSC516),  
ID_ANSC223  = forcats::as_factor(ID_ANSC223),   
ID_ANSC224  = forcats::as_factor(ID_ANSC224), 
ID_ANSC225  = forcats::as_factor(ID_ANSC225),  
ID_ANSC230  = forcats::as_factor(ID_ANSC230),  
ID_ANSC301  = forcats::as_factor(ID_ANSC301),  
ID_ANSC315  = forcats::as_factor(ID_ANSC315),   
ID_ANSC340  = forcats::as_factor(ID_ANSC340), 
ID_ANSC409  = forcats::as_factor(ID_ANSC409),  
ID_ANSC411  = forcats::as_factor(ID_ANSC411),  
ID_ANSC425  = forcats::as_factor(ID_ANSC425),  
ID_FOR111   = forcats::as_factor(ID_FOR111),
ID_FOR200   = forcats::as_factor(ID_FOR200),
ID_FOR230   = forcats::as_factor(ID_FOR230), 
ID_FOR233   = forcats::as_factor(ID_FOR233), 
ID_FOR302   = forcats::as_factor(ID_FOR302), 
ID_FOR313   = forcats::as_factor(ID_FOR313),
ID_FOR402   = forcats::as_factor(ID_FOR402),
ID_FOR404   = forcats::as_factor(ID_FOR404), 
ID_FOR420   = forcats::as_factor(ID_FOR420), 
ID_FOR478   = forcats::as_factor(ID_FOR478), 
ID_FOR480   = forcats::as_factor(ID_FOR480),
ID_GISC250  = forcats::as_factor(ID_GISC250), 
ID_GISC260  = forcats::as_factor(ID_GISC260),  
ID_PLSC101  = forcats::as_factor(ID_PLSC101),  
ID_PLSC211  = forcats::as_factor(ID_PLSC211),  
ID_PLSC284  = forcats::as_factor(ID_PLSC284),   
ID_PLSC310  = forcats::as_factor(ID_PLSC310), 
ID_PLSC311  = forcats::as_factor(ID_PLSC311),  
ID_PLSC312  = forcats::as_factor(ID_PLSC312),  
ID_PLSC400  = forcats::as_factor(ID_PLSC400),  
ID_WILD314  = forcats::as_factor(ID_WILD314),   
ID_WILD347  = forcats::as_factor(ID_WILD347)
    ) 

finish_formula <-  PCT_FINISH ~ Term_20203 +    Upper +
    ID_AGBU310 + ID_AGBU402+ID_AGBU425+ID_AGSC320+ID_AGSC411+ID_AGSC516+ID_ANSC223+ID_ANSC224+ID_ANSC225+ID_ANSC230+ID_ANSC301+ID_ANSC340+ID_ANSC409+ID_ANSC411+ID_FOR111 +ID_FOR200 +ID_FOR230 +ID_FOR233 +ID_FOR302 +ID_FOR313 +ID_FOR402 +ID_FOR404 +ID_FOR420  +ID_GISC250+ID_GISC260+ID_PLSC101+ID_PLSC284+ID_PLSC310+ID_PLSC312+ID_PLSC400+ID_WILD314

pass_formula <-  PCT_PASS ~ Term_20203 +    Upper +
ID_AGBU310 + ID_AGBU402+ID_AGBU425+ID_AGSC320+ID_AGSC411+ID_AGSC516+ID_ANSC223+ID_ANSC224+ID_ANSC225+ID_ANSC230+ID_ANSC301+ID_ANSC340+ID_ANSC409+ID_ANSC411+ID_FOR111 +ID_FOR200 +ID_FOR230 +ID_FOR233 +ID_FOR302 +ID_FOR313 +ID_FOR402 +ID_FOR404 +ID_FOR420  +ID_GISC250+ID_GISC260+ID_PLSC101+ID_PLSC284+ID_PLSC310+ID_PLSC312+ID_PLSC400+ID_WILD314

#+ID_FOR480

A_formula <-  PCT_A ~ Term_20203 +  Upper +
ID_AGBU310 + ID_AGBU402+ID_AGBU425+ID_AGSC320+ID_AGSC411+ID_AGSC516+ID_ANSC223+ID_ANSC224+ID_ANSC225+ID_ANSC230+ID_ANSC301+ID_ANSC340+ID_ANSC409+ID_ANSC411+ID_FOR111 +ID_FOR200 +ID_FOR230 +ID_FOR233 +ID_FOR302 +ID_FOR313 +ID_FOR402 +ID_FOR404 +ID_FOR420  +ID_GISC250+ID_GISC260+ID_PLSC101+ID_PLSC284+ID_PLSC310+ID_PLSC312+ID_PLSC400+ID_WILD314

finish_poisson <- glm(finish_formula, family = poisson(link = "identity"), data = d2_dum)
#summary(finish_poisson)
fp <- coeftest(finish_poisson, vcov = vcovHC(finish_poisson, type="HC1"))

pass_poisson <- glm(pass_formula, family = poisson(link = "identity"), data = d2_dum)
pp <- coeftest(pass_poisson, vcov = vcovHC(pass_poisson, type="HC1"))
#summary(pass_poisson)

a_poisson <- glm(A_formula, family = poisson(link = "identity"), data = d2_dum)
pa <- coeftest(a_poisson, vcov = vcovHC(a_poisson, type="HC1"))
```

# Results and Discussion

The summary results of the two Poisson regressions are shown in Table \@ref(tab:poissonmodelresults). In the first column, it is shown that The 2020 spring term had a significant negative effect on finishing, a significant positive effect on passing courses, and a significant positive effect on earning an A. There are likely numerous explanations to this effect (including an under-identified model) and a more complete examination of student data is warranted. The size of the effect is shown in Figure \@ref(fig:poissonmodelresults).

```{r poissonmodelresults, echo=FALSE, warning=FALSE, results='asis'}
stargazer(pp,fp,pa, title = "Poisson Regression Results", align = TRUE, out = 'result.html', no.space=TRUE, single.row=TRUE,
column.labels=c("Percent Passing","Percent Finishing","Percent Earning A"), model.numbers=FALSE)
```

One such explanation is the different approaches to moving a class online. Anecdotely, some instructors were unable to imagine their courses presented remotely and simply awarded grades or compensated for their lack of confidence in their remote teaching abilities by awarding grades generously. This narative somewhat fits the data, if a student put in effort, they were more likely to pass and earn an A, but nothing can be done about giving up and withdrawing from a course. One author to this study teaches the AGBU-310 and AGBU-402 courses. AGBU-310 is a policy class with a large policy proposal as the capstone of the course. The course met via zoom for the lecture portion of the course and zoom office hours were provided for the research portion. More students than usual (I am unable to quantify due to the restrictions of the Human Use Committee approval) withdrew from the course after returning home and working. In the case of AGBU-402, the course is a farm management course that is typically a wake up call for students. There is typically a large contingent that will withdraw early. In the 2020 term, more students than usual did not withdraw and stayed enrolled even though it was clear (to both the professor and the student) that they were not devoting the needed time to the course. 

```{r marginalfigure, echo=FALSE}
ggFinish <- ggpredict(finish_poisson,   "Term_20203")
pggFinish <- plot(ggFinish) + 
    xlab('Spring 2020 Dummy') +
    ylab('Percent Finishing') +
    ggtitle('')+ 
    cowplot::theme_cowplot(font_size = 12)

ggPass <- ggpredict(pass_poisson, terms = "Term_20203")
pggPass <- plot(ggPass) + 
    xlab('Spring 2020 Dummy') +
    ylab('Percent Passing') +
    ggtitle('')+ 
    cowplot::theme_cowplot(font_size = 12)

ggA <- ggpredict(a_poisson, terms = "Term_20203")
pggA <- plot(ggA) + 
    xlab('Spring 2020 Dummy') +
    ylab('Percent Earning A') +
    ggtitle('')+ 
    cowplot::theme_cowplot(font_size = 12)
cowplot::plot_grid(pggFinish,pggPass,pggA, labels = c('A','B','C'))


```


Students returning home to work was a common theme among professors discussing the term. Students _may_ have needed to work to support their family. This was not an unusual report to receive from a student. Other students may have come from agricultural families and were called home to work on the farm. Louisiana agriculture is partially dependent on migrant labor and this labor was difficult to keep engaged during March and April of 2020.

Future research needs to address student demographic variables and the student's academic history to understand how the transition online affected individual students and their academic achievement. At LaTech, this type of research will require a signed statement allowing the student to _opt-in_ to the research project. For students that have stopped or dropped out, this may be impossible to acquire as those students are not likely to respond to inquiries. 





# Appendix



# References